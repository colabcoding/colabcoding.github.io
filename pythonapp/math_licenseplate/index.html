<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>License Plate Math Pro</title>
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <style>
        :root {
            --bg-color: radial-gradient(circle at center, #2d3748 0%, #1a202c 100%);
            --text-color: white;
            --panel-bg: rgba(255, 255, 255, 0.98);
            --panel-text: #2d3748;
            --stats-bg: rgba(0, 0, 0, 0.4);
            --brand-color: #cbd5e0;
        }

        .light-theme {
            --bg-color: #f7fafc;
            --text-color: #1a202c;
            --panel-bg: #ffffff;
            --panel-text: #2d3748;
            --stats-bg: rgba(226, 232, 240, 0.8);
            --brand-color: #4a5568;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; margin: 0; 
            background: var(--bg-color); color: var(--text-color);
            transition: background 0.3s ease; padding-bottom: 60px;
        }

        .brand-header {
            font-size: 0.8rem; color: var(--brand-color); margin-top: 10px;
            display: flex; align-items: center; gap: 8px; font-weight: 600;
        }
        .brand-header img { height: 18px; width: auto; }

        .toolbar { display: flex; gap: 8px; margin: 15px 0; flex-wrap: wrap; justify-content: center; }
        .stats-bar { 
            display: flex; gap: 20px; margin-bottom: 15px; font-weight: bold; 
            background: var(--stats-bg); padding: 10px 25px; 
            border-radius: 50px; border: 2px solid #ed8936;
        }
        
        .license-plate {
            background-color: #f8f9fa; border: 5px solid #1a202c; border-radius: 12px;
            padding: 10px 30px; display: inline-block; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 15px; position: relative; overflow: hidden; min-width: 250px;
        }
        .plate-text { 
            font-family: 'Courier New', monospace; font-size: 4.2rem; font-weight: 900; 
            color: #1a202c; display: flex; gap: 15px; align-items: center; justify-content: center;
            padding-bottom: 2px;
        }
        .plate-expiry {
            font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: 700;
            color: #333; text-align: center; width: 100%; display: block;
            margin-top: -6px; padding-bottom: 1px;
        }
        
        .ev-strip {
            display: none; position: absolute; bottom: 0; left: 0;
            width: 100%; height: 30%; background-color: #3182ce;
            border-top: 1px solid #2b6cb0;
        }
        .is-ev .ev-strip { display: block; }
        .is-ev .plate-expiry { color: white; position: relative; z-index: 2; padding-top: 5px; }

        .controls { margin-bottom: 15px; display: flex; gap: 10px; }
        input { font-size: 1.6rem; padding: 8px; width: 90px; text-align: center; border: 2px solid #1a202c; border-radius: 8px; background: white; color: black; }
        
        button { font-size: 0.9rem; padding: 8px 15px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        .btn-go { background-color: #f6e05e; color: #1a202c; font-size: 1.2rem; padding: 8px 25px; }
        .btn-toggle { background-color: #4a5568; color: white; }

        #log-panel {
            width: 90%; max-width: 400px; height: 130px; background: var(--panel-bg); border-radius: 10px; 
            overflow-y: auto; padding: 12px; font-size: 0.85rem; color: var(--panel-text); 
            box-shadow: 0 8px 16px rgba(0,0,0,0.4); border: 1px solid #cbd5e0;
        }
        .log-entry { margin-bottom: 8px; border-bottom: 1px solid #e2e8f0; padding-bottom: 4px; }

        footer {
            position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.95);
            color: #cbd5e0; text-align: center; padding: 8px 0; font-size: 0.75rem;
            border-top: 1px solid #ed8936; z-index: 50;
        }
        footer .footer-content { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; max-width: 900px; margin: 0 auto; }
        footer a { color: #f6e05e; text-decoration: none; font-weight: bold; }

        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); color: white; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100; text-align: center;
        }
        .modal-content { max-width: 85%; line-height: 1.6; background: #2d3748; padding: 25px; border-radius: 15px; border: 1px solid #ed8936; }
    </style>
</head>
<body id="main-body">

    <div class="brand-header">
        made with <img src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Python-logo-notext.svg" alt="Python"> Python & <img src="https://pyscript.net/assets/images/pyscript-sticker-black.svg" alt="PyScript"> PyScript
    </div>

    <h1 style="font-size: 1.8rem; margin: 10px 0;">License Plate Math</h1>

    <div class="toolbar">
        <button class="btn-toggle" py-click="toggle_theme">üåì Theme</button>
        <button class="btn-toggle" py-click="toggle_ev">üîå Electric</button>
    </div>
    
    <div class="stats-bar">
        <span>Lives: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
        <span>Score: <span id="score">0</span></span>
        <span>Avg: <span id="avg-time">0.0</span>s</span>
    </div>
    
    <div id="plate-container" class="license-plate">
        <div class="plate-text">
            <span>B</span><span id="numbers-display"></span><span id="suffix-display" style="font-size: 4.2rem; color: #4a5568;"></span>
        </div>
        <div class="plate-expiry">01 ‚Ä¢ 31</div>
        <div class="ev-strip"></div>
    </div>
    
    <div class="controls">
        <input type="number" id="user-answer" inputmode="numeric" pattern="[0-9]*" placeholder="?">
        <button id="submit-btn" class="btn-go" py-click="check_answer">SUBMIT</button>
    </div>

    <div id="log-panel"></div>
    <button class="btn-toggle" style="margin-top: 8px; font-size: 0.9rem;" py-click="toggle_leaderboard">üèÜ Hall of Fame</button>

    <div id="game-over-screen" class="modal">
        <h2>GAME OVER</h2>
        <div id="final-stats"></div>
        <button class="btn-go" py-click="restart_game">RESTART</button>
    </div>

    <div id="leaderboard-modal" class="modal">
        <h2>Top Leader</h2>
        <table style="width: 85%; border-collapse: collapse; font-size: 0.9rem; margin-bottom: 20px;">
            <tbody id="leaderboard-body"></tbody>
        </table>
        <button class="btn-toggle" py-click="toggle_leaderboard">Close</button>
    </div>

    <footer>
        <div class="footer-content">
            <span>&copy; Andi Dinata 2026</span>
            <span class="divider">|</span>
            <span>CC BY-NC-SA 4.0</span>
            <span class="divider">|</span>
            <a href="https://colabcoding.github.io" target="_blank">colabcoding.github.io</a>
            <span class="divider">|</span>
            <a href="mailto:colab.code@outlook.com">Email us</a>
            <span class="divider">|</span>
            <a href="https://instagram.com/colab.code" target="_blank">@colab.code</a>
        </div>
    </footer>
    <script type="py">
        import random, string, time, json
        from pyscript import document, window

        state = {
            "r1": [], "correct_answer": 0, "sum1": 0, "start_time": 0,
            "score": 0, "lives": 3, "times": []
        }

        def init_settings():
            prefs = json.loads(window.localStorage.getItem("user_prefs") or '{"theme": "dark", "is_ev": false}')
            if prefs["theme"] == "light": document.body.classList.add("light-theme")
            if prefs["is_ev"]: document.querySelector("#plate-container").classList.add("is-ev")

        def save_prefs():
            is_light = document.body.classList.contains("light-theme")
            is_ev = document.querySelector("#plate-container").classList.contains("is-ev")
            window.localStorage.setItem("user_prefs", json.dumps({"theme": "light" if is_light else "dark", "is_ev": is_ev}))

        def toggle_theme(event):
            document.body.classList.toggle("light-theme")
            save_prefs()

        def toggle_ev(event):
            document.querySelector("#plate-container").classList.toggle("is-ev")
            save_prefs()

        def generate_new_problem():
            state["r1"] = [random.randint(1,9) for _ in range(4)]
            state["sum1"] = sum(state["r1"])
            state["correct_answer"] = sum(int(d) for d in str(state["sum1"]))
            document.querySelector("#numbers-display").innerText = "".join(map(str, state["r1"]))
            document.querySelector("#suffix-display").innerText = "".join(random.choices(string.ascii_uppercase, k=3))
            document.querySelector("#user-answer").value = ""
            state["start_time"] = time.time()

        def check_answer(event):
            val_raw = document.querySelector("#user-answer").value
            if not val_raw: return
            elapsed = round(time.time() - state["start_time"], 2)
            state["times"].append(elapsed)
            avg = round(sum(state["times"]) / len(state["times"]), 1)
            document.querySelector("#avg-time").innerText = str(avg)
            
            log_div = document.querySelector("#log-panel")
            entry = document.createElement("div")
            entry.className = "log-entry"

            if int(val_raw) == state["correct_answer"]:
                state["score"] += 1
                entry.innerHTML = f"<span style='color:#38a169; font-weight:bold'>‚úì {val_raw}</span> ({elapsed}s)"
                document.querySelector("#score").innerText = str(state["score"])
            else:
                state["lives"] -= 1
                steps = f"{' + '.join(map(str, state['r1']))} = {state['sum1']} ‚ûî {' + '.join(list(str(state['sum1'])))} = {state['correct_answer']}"
                entry.innerHTML = f"<span style='color:#e53e3e; font-weight:bold'>‚úó {val_raw}</span> ({elapsed}s)<br><small style='color:#718096'>Logic: {steps}</small>"
                document.querySelector("#lives").innerText = "‚ù§Ô∏è" * state["lives"]

            log_div.prepend(entry)
            if state["lives"] <= 0:
                handle_game_over(avg)
            else:
                generate_new_problem()

        def handle_game_over(avg):
            document.querySelector("#game-over-screen").style.display = "flex"
            document.querySelector("#final-stats").innerHTML = f"Score: {state['score']} | Avg: {avg}s"
            scores = json.loads(window.localStorage.getItem("jakarta_plates") or "[]")
            if not scores or state["score"] > scores[-1]["score"] or len(scores) < 5:
                name = window.prompt("Hall of Fame! Name:") or "Driver"
                scores.append({"name": name, "score": state["score"], "avg": avg})
                scores = sorted(scores, key=lambda x: x["score"], reverse=True)[:5]
                window.localStorage.setItem("jakarta_plates", json.dumps(scores))

        def toggle_leaderboard(event):
            m = document.querySelector("#leaderboard-modal")
            if m.style.display == "flex": m.style.display = "none"
            else:
                m.style.display = "flex"
                scores = json.loads(window.localStorage.getItem("jakarta_plates") or "[]")
                tbody = document.querySelector("#leaderboard-body")
                tbody.innerHTML = ""
                for idx, s in enumerate(scores):
                    tbody.innerHTML += f"<tr style='border-bottom: 1px solid #4a5568;'><td>{idx+1}</td><td>{s['name']}</td><td>{s['score']}</td><td>{s['avg']}s</td></tr>"

        def restart_game(event):
            state.update({"score": 0, "lives": 3, "times": []})
            document.querySelector("#score").innerText = "0"
            document.querySelector("#avg-time").innerText = "0.0"
            document.querySelector("#lives").innerText = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è"
            document.querySelector("#log-panel").innerHTML = ""
            document.querySelector("#game-over-screen").style.display = "none"
            generate_new_problem()

        init_settings()
        generate_new_problem()
    </script>
</body>
</html>
