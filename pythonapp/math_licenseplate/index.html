<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>License Plate Math Pro - Jakarta Edition</title>
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            margin: 0; 
            /* High-performance Solid/Gradient Background */
            background: radial-gradient(circle at center, #2d3748 0%, #1a202c 100%);
            color: white;
            padding-bottom: 100px;
        }

        h1 { text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin-top: 30px; letter-spacing: 1px; }
        
        .stats-bar { 
            display: flex; gap: 20px; margin-bottom: 20px; font-weight: bold; 
            background: rgba(0, 0, 0, 0.4); padding: 12px 30px; 
            border-radius: 50px; border: 2px solid #ed8936;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .license-plate {
            background-color: #f8f9fa; border: 6px solid #1a202c; border-radius: 12px;
            padding: 15px 35px; display: inline-block; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        .plate-text { font-family: 'Courier New', monospace; font-size: 3.8rem; font-weight: 900; color: #1a202c; display: flex; gap: 15px; align-items: center; }

        .controls { margin-bottom: 20px; display: flex; gap: 10px; }
        input { font-size: 1.8rem; padding: 10px; width: 90px; text-align: center; border: 3px solid #1a202c; border-radius: 8px; color: #1a202c; font-weight: bold; }
        
        button { font-size: 1.3rem; padding: 10px 25px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: all 0.2s; }
        .btn-go { background-color: #f6e05e; color: #1a202c; }
        .btn-go:hover { background-color: #ecc94b; transform: scale(1.05); }
        .btn-leaderboard { background-color: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); margin-top: 10px; }

        #log-panel {
            width: 440px; height: 160px; background: rgba(255, 255, 255, 0.98); border-radius: 10px; 
            overflow-y: auto; padding: 15px; font-size: 0.9rem; color: #2d3748; box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }
        .log-entry { margin-bottom: 12px; border-bottom: 1px solid #e2e8f0; padding-bottom: 6px; }
        .log-success { color: #38a169; font-weight: bold; }
        .log-error { color: #e53e3e; font-weight: bold; }
        .step-hint { display: block; font-size: 0.8rem; color: #718096; font-family: 'Courier New', monospace; margin-top: 4px; }

        footer {
            position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.95);
            color: #a0aec0; text-align: center; padding: 15px 0; font-size: 0.8rem;
            border-top: 2px solid #ed8936; line-height: 1.6;
        }
        footer a { color: #f6e05e; text-decoration: none; font-weight: bold; }
        footer .cc-badge { font-weight: bold; color: #cbd5e0; display: block; margin-bottom: 5px; }

        #game-over-screen, #leaderboard-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); color: white; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }
    </style>
</head>
<body>

    <h1>License Plate Math</h1>
    
    <div class="stats-bar">
        <span>Lives: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
        <span>Score: <span id="score">0</span></span>
        <span>Avg: <span id="avg-time">0.0</span>s</span>
    </div>
    
    <div class="license-plate">
        <div class="plate-text">
            <span>B</span><span id="numbers-display"></span><span id="suffix-display" style="font-size: 2.8rem; color: #4a5568;"></span>
        </div>
    </div>
    
    <div class="controls">
        <input type="number" id="user-answer" placeholder="?">
        <button id="submit-btn" class="btn-go" py-click="check_answer">GO</button>
    </div>

    <div id="log-panel"></div>
    <button class="btn-leaderboard" py-click="toggle_leaderboard">üèÜ Hall of Fame</button>

    <div id="game-over-screen">
        <h2>GAME OVER</h2>
        <div id="final-stats" style="font-size: 1.5rem; margin: 20px 0;"></div>
        <button class="btn-go" py-click="restart_game">RESTART MISSION</button>
    </div>

    <div id="leaderboard-modal">
        <h2>Jakarta Top Drivers</h2>
        <table style="width: 80%; max-width: 500px; border-collapse: collapse;">
            <thead><tr style="border-bottom: 2px solid #ed8936;"><th>Rank</th><th>Driver</th><th>Score</th><th>Speed</th></tr></thead>
            <tbody id="leaderboard-body"></tbody>
        </table>
        <button class="btn-leaderboard" style="margin-top:20px" py-click="toggle_leaderboard">Close</button>
    </div>

    <footer>
        <span class="cc-badge">Licensed under Creative Commons BY-NC-SA 4.0</span>
        &copy; Andi Dinata 2026 | Website : 
        <a href="https://colabcoding.github.io" target="_blank">colabcoding.github.io</a><br>
        Email: <a href="mailto:colab.code@outlook.com">colab.code@outlook.com</a> | 
        Instagram: <a href="https://instagram.com/colab.code" target="_blank">@colab.code</a>
    </footer>

    <script type="py">
        import random, string, time, json
        from pyscript import document, window

        state = {
            "r1": [], "correct_answer": 0, "sum1": 0, "start_time": 0,
            "score": 0, "lives": 3, "times": []
        }

        def generate_new_problem():
            state["r1"] = [random.randint(1,9) for _ in range(4)]
            state["sum1"] = sum(state["r1"])
            state["correct_answer"] = sum(int(d) for d in str(state["sum1"]))
            
            document.querySelector("#numbers-display").innerText = "".join(map(str, state["r1"]))
            document.querySelector("#suffix-display").innerText = "".join(random.choices(string.ascii_uppercase, k=3))
            document.querySelector("#user-answer").value = ""
            state["start_time"] = time.time()

        def check_answer(event):
            val_raw = document.querySelector("#user-answer").value
            if not val_raw: return
            
            elapsed = round(time.time() - state["start_time"], 2)
            state["times"].append(elapsed)
            
            avg = round(sum(state["times"]) / len(state["times"]), 1)
            document.querySelector("#avg-time").innerText = str(avg)

            log_div = document.querySelector("#log-panel")
            entry = document.createElement("div")
            entry.className = "log-entry"

            if int(val_raw) == state["correct_answer"]:
                state["score"] += 1
                entry.innerHTML = f"<span class='log-success'>Great! ‚úì {val_raw}</span> ({elapsed}s)"
                document.querySelector("#score").innerText = str(state["score"])
            else:
                state["lives"] -= 1
                steps = f"{' + '.join(map(str, state['r1']))} = {state['sum1']} ‚ûî {' + '.join(list(str(state['sum1'])))} = {state['correct_answer']}"
                entry.innerHTML = f"<span class='log-error'>Oops, sorry! ‚úó {val_raw}</span> ({elapsed}s)<br><span class='step-hint'>Logic: {steps}</span>"
                document.querySelector("#lives").innerText = "‚ù§Ô∏è" * state["lives"]

            log_div.prepend(entry)
            
            if state["lives"] <= 0:
                handle_game_over(avg)
            else:
                generate_new_problem()

        def handle_game_over(avg):
            document.querySelector("#game-over-screen").style.display = "flex"
            document.querySelector("#final-stats").innerHTML = f"Score: {state['score']} | Avg Speed: {avg}s"
            
            scores = json.loads(window.localStorage.getItem("jakarta_plates") or "[]")
            if len(scores) < 5 or state["score"] > scores[-1]["score"]:
                name = window.prompt("TOP TIER SCORE! Enter your driver name:") or "Racer"
                scores.append({"name": name, "score": state["score"], "avg": avg})
                scores = sorted(scores, key=lambda x: x["score"], reverse=True)[:5]
                window.localStorage.setItem("jakarta_plates", json.dumps(scores))

        def toggle_leaderboard(event):
            modal = document.querySelector("#leaderboard-modal")
            if modal.style.display == "flex":
                modal.style.display = "none"
            else:
                modal.style.display = "flex"
                scores = json.loads(window.localStorage.getItem("jakarta_plates") or "[]")
                tbody = document.querySelector("#leaderboard-body")
                tbody.innerHTML = ""
                for idx, s in enumerate(scores):
                    row = f"<tr style='border-bottom: 1px solid #4a5568;'><td>{idx+1}</td><td>{s['name']}</td><td>{s['score']}</td><td>{s['avg']}s</td></tr>"
                    tbody.innerHTML += row

        def restart_game(event):
            state.update({"score": 0, "lives": 3, "times": []})
            document.querySelector("#score").innerText = "0"
            document.querySelector("#avg-time").innerText = "0.0"
            document.querySelector("#lives").innerText = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è"
            document.querySelector("#log-panel").innerHTML = ""
            document.querySelector("#game-over-screen").style.display = "none"
            generate_new_problem()

        generate_new_problem()
    </script>
</body>
</html>
