<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>License Plate Math</title>
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <style>
        :root {
            --bg-color: radial-gradient(circle at center, #2d3748 0%, #1a202c 100%);
            --text-color: white;
            --panel-bg: rgba(255, 255, 255, 0.98);
            --panel-text: #2d3748;
            --stats-bg: rgba(0, 0, 0, 0.4);
        }

        .light-theme {
            --bg-color: #f7fafc;
            --text-color: #1a202c;
            --panel-bg: #ffffff;
            --panel-text: #2d3748;
            --stats-bg: rgba(226, 232, 240, 0.8);
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; margin: 0; 
            background: var(--bg-color); color: var(--text-color);
            transition: background 0.3s ease; padding-bottom: 120px;
        }

        .toolbar { display: flex; gap: 15px; margin: 20px 0; }
        .stats-bar { 
            display: flex; gap: 20px; margin-bottom: 20px; font-weight: bold; 
            background: var(--stats-bg); padding: 12px 30px; 
            border-radius: 50px; border: 2px solid #ed8936;
        }
        
        /* Plate Design */
        .license-plate {
            background-color: #f8f9fa; border: 6px solid #1a202c; border-radius: 12px;
            padding: 15px 35px; display: inline-block; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px; position: relative; overflow: hidden;
        }
        .plate-text { 
            font-family: 'Courier New', monospace; font-size: 3.8rem; font-weight: 900; 
            color: #1a202c; display: flex; gap: 15px; align-items: center;
            padding-bottom: 5px;
        }
        
        /* EV Blue Strip */
        .ev-strip {
            display: none; position: absolute; bottom: 0; left: 0;
            width: 100%; height: 20%; background-color: #3182ce;
            border-top: 2px solid #2b6cb0;
        }
        .is-ev .ev-strip { display: block; }
        .is-ev .plate-text { padding-bottom: 15px; }

        .controls { margin-bottom: 20px; display: flex; gap: 10px; }
        input { font-size: 1.8rem; padding: 10px; width: 90px; text-align: center; border: 3px solid #1a202c; border-radius: 8px; }
        
        button { font-size: 1.1rem; padding: 8px 20px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        .btn-go { background-color: #f6e05e; color: #1a202c; }
        .btn-toggle { background-color: #4a5568; color: white; }

        #log-panel {
            width: 440px; height: 160px; background: var(--panel-bg); border-radius: 10px; 
            overflow-y: auto; padding: 15px; font-size: 0.9rem; color: var(--panel-text); 
            box-shadow: 0 10px 20px rgba(0,0,0,0.4); border: 1px solid #cbd5e0;
        }
        .log-entry { margin-bottom: 12px; border-bottom: 1px solid #e2e8f0; padding-bottom: 6px; }

        footer {
            position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.95);
            color: #a0aec0; text-align: center; padding: 15px 0; font-size: 0.8rem;
            border-top: 2px solid #ed8936; line-height: 1.6; z-index: 50;
        }
        footer a { color: #f6e05e; text-decoration: none; font-weight: bold; }

        #game-over-screen, #leaderboard-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); color: white; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }
    </style>
</head>
<body>

    <h1>License Plate Math</h1>

    <div class="stats-bar">
        <span>Lives: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
        <span>Score: <span id="score">0</span></span>
        <span>Avg: <span id="avg-time">0.0</span>s</span>
    </div>
    

    <div class="toolbar">
        <button class="btn-toggle" py-click="toggle_theme">üåô Theme</button>
        <button class="btn-toggle" py-click="toggle_ev">üîãEV </button>
    </div>


    <div id="plate-container" class="license-plate">
        <div class="plate-text">
            <span>B</span><span id="numbers-display"></span><span id="suffix-display" style="font-size: 2.8rem; color: #4a5568;"></span>
        </div>
        <div class="ev-strip"></div>
    </div>
    
    <div class="controls">
        <input type="number" id="user-answer" placeholder="?">
        <button id="submit-btn" class="btn-go" py-click="check_answer">SUBMIT</button>
    </div>

    <div id="log-panel"></div>
    <button class="btn-toggle" style="margin-top: 10px;" py-click="toggle_leaderboard">üèÜ Hall of Fame</button>

    <div id="game-over-screen">
        <h2>GAME OVER</h2>
        <div id="final-stats"></div>
        <button class="btn-go" py-click="restart_game">RESTART</button>
    </div>

    <div id="leaderboard-modal">
        <h2>Jakarta Top Drivers</h2>
        <table style="width: 80%; max-width: 500px; border-collapse: collapse;">
            <thead><tr style="border-bottom: 2px solid #ed8936;"><th>Rank</th><th>Driver</th><th>Score</th><th>Speed</th></tr></thead>
            <tbody id="leaderboard-body"></tbody>
        </table>
        <button class="btn-toggle" style="margin-top:20px" py-click="toggle_leaderboard">Close</button>
    </div>

    <footer>
        <span style="display:block; margin-bottom:5px">Licensed under Creative Commons BY-NC-SA 4.0</span>
        &copy; Andi Dinata 2026 | Common Access | 
        <a href="https://colabcoding.github.io" target="_blank">colabcoding.github.io</a><br>
        Email: <a href="mailto:colab.code@outlook.com">colab.code@outlook.com</a> | 
        Instagram: <a href="https://instagram.com/colab.code" target="_blank">@colab.code</a>
    </footer>

    <script type="py">
        import random, string, time, json
        from pyscript import document, window

        state = {
            "r1": [], "correct_answer": 0, "sum1": 0, "start_time": 0,
            "score": 0, "lives": 3, "times": []
        }

        def toggle_theme(event):
            document.body.classList.toggle("light-theme")

        def toggle_ev(event):
            document.querySelector("#plate-container").classList.toggle("is-ev")

        def generate_new_problem():
            state["r1"] = [random.randint(1,9) for _ in range(4)]
            state["sum1"] = sum(state["r1"])
            state["correct_answer"] = sum(int(d) for d in str(state["sum1"]))
            document.querySelector("#numbers-display").innerText = "".join(map(str, state["r1"]))
            document.querySelector("#suffix-display").innerText = "".join(random.choices(string.ascii_uppercase, k=3))
            document.querySelector("#user-answer").value = ""
            state["start_time"] = time.time()

        def check_answer(event):
            val_raw = document.querySelector("#user-answer").value
            if not val_raw: return
            
            elapsed = round(time.time() - state["start_time"], 2)
            state["times"].append(elapsed)
            avg = round(sum(state["times"]) / len(state["times"]), 1)
            document.querySelector("#avg-time").innerText = str(avg)

            log_div = document.querySelector("#log-panel")
            entry = document.createElement("div")
            entry.className = "log-entry"

            if int(val_raw) == state["correct_answer"]:
                state["score"] += 1
                entry.innerHTML = f"<span style='color:#38a169; font-weight:bold'>Great! ‚úì {val_raw}</span> ({elapsed}s)"
                document.querySelector("#score").innerText = str(state["score"])
            else:
                state["lives"] -= 1
                steps = f"{' + '.join(map(str, state['r1']))} = {state['sum1']} ‚ûî {' + '.join(list(str(state['sum1'])))} = {state['correct_answer']}"
                entry.innerHTML = f"<span style='color:#e53e3e; font-weight:bold'>Oops! ‚úó {val_raw}</span> ({elapsed}s)<br><small style='color:#718096'>Logic: {steps}</small>"
                document.querySelector("#lives").innerText = "‚ù§Ô∏è" * state["lives"]

            log_div.prepend(entry)
            if state["lives"] <= 0:
                handle_game_over(avg)
            else:
                generate_new_problem()

        def handle_game_over(avg):
            document.querySelector("#game-over-screen").style.display = "flex"
            document.querySelector("#final-stats").innerHTML = f"Score: {state['score']} | Avg Speed: {avg}s"
            scores = json.loads(window.localStorage.getItem("jakarta_plates") or "[]")
            if len(scores) < 5 or state["score"] > scores[-1]["score"]:
                name = window.prompt("TOP TIER SCORE! Enter name:") or "Racer"
                scores.append({"name": name, "score": state["score"], "avg": avg})
                scores = sorted(scores, key=lambda x: x["score"], reverse=True)[:5]
                window.localStorage.setItem("jakarta_plates", json.dumps(scores))

        def toggle_leaderboard(event):
            modal = document.querySelector("#leaderboard-modal")
            if modal.style.display == "flex":
                modal.style.display = "none"
            else:
                modal.style.display = "flex"
                scores = json.loads(window.localStorage.getItem("jakarta_plates") or "[]")
                tbody = document.querySelector("#leaderboard-body")
                tbody.innerHTML = ""
                for idx, s in enumerate(scores):
                    tbody.innerHTML += f"<tr style='border-bottom: 1px solid #4a5568;'><td>{idx+1}</td><td>{s['name']}</td><td>{s['score']}</td><td>{s['avg']}s</td></tr>"

        def restart_game(event):
            state.update({"score": 0, "lives": 3, "times": []})
            document.querySelector("#score").innerText = "0"
            document.querySelector("#avg-time").innerText = "0.0"
            document.querySelector("#lives").innerText = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è"
            document.querySelector("#log-panel").innerHTML = ""
            document.querySelector("#game-over-screen").style.display = "none"
            generate_new_problem()

        generate_new_problem()
    </script>
</body>
</html>
