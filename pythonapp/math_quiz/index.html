<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Endless Math Quiz</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { 
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            padding: 20px; 
            background-color: #f0f2f5;
            max-width: 500px;
            margin: 0 auto;
        }
        
        h2 { text-align: center; color: #1a73e8; margin-bottom: 30px; }

        input, button {
            width: 100%;
            padding: 18px;
            margin: 12px 0;
            font-size: 1.25rem; 
            border-radius: 12px;
            border: 2px solid #ddd;
            box-sizing: border-box;
            -webkit-appearance: none; /* Removes iOS default styling */
        }

        input:focus {
            outline: none;
            border-color: #1a73e8;
            background: #fff;
        }

        button {
            background-color: #1a73e8;
            color: white;
            border: none;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        #question-text {
            font-size: 2.2rem;
            text-align: center;
            font-weight: 800;
            margin: 30px 0;
            color: #202124;
        }

        #output { 
            background: #ffffff; 
            padding: 15px; 
            border-radius: 12px; 
            margin-top: 20px; 
            height: 150px; 
            overflow-y: auto;
            white-space: pre-line;
            border: 1px solid #e0e0e0;
            font-family: monospace;
        }

        .stats-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>

    <h2>Math Quiz</h2>
    
    <div id="setup-area">
        <input type="text" id="player-name" placeholder="Your Name">
        <button id="start-btn" py-click="start_game">Start Quiz</button>
    </div>

    <div id="game-area" style="display:none;">
        <p id="question-text"></p>
        <input type="text" id="answer-input" inputmode="decimal" placeholder="Enter answer (e.g. -5)">
        <button id="submit-btn" py-click="check_answer">Submit</button>
        <div id="output"></div>
    </div>

<script type="py">
import random
import time
from pyscript import document

state = {
    "player": "",
    "correct_count": 0,
    "incorrect_count": 0,
    "total_duration": 0,
    "current_q_start": 0,
    "correct_answer": 0,
    "operators": ['*', '+', '-']
}

def start_game(event):
    state["player"] = document.querySelector("#player-name").value or "Player"
    document.querySelector("#setup-area").style.display = "none"
    document.querySelector("#game-area").style.display = "block"
    log(f"Welcome {state['player']}!")
    generate_question()

def generate_question():
    state["current_q_start"] = time.time()
    # To encourage negative results, we can use a smaller n1 and larger n2 for subtraction
    n1 = random.randint(1, 15)
    n2 = random.randint(1, 15)
    op = random.choice(state["operators"])
    
    # Ensure some variety where negative answers are likely
    question_str = f"{n1} {op} {n2}"
    state["correct_answer"] = eval(question_str)
    
    document.querySelector("#question-text").innerText = f"{question_str} = ?"
    document.querySelector("#answer-input").value = ""
    document.querySelector("#answer-input").focus()

def check_answer(event):
    val = document.querySelector("#answer-input").value.strip()
    if not val: return
    
    try:
        # We use float then int to handle cases where users might type -5.0
        answer = int(float(val))
    except ValueError:
        log("Please enter a valid number")
        return

    duration = round(time.time() - state["current_q_start"], 2)
    state["total_duration"] += duration

    if answer == state["correct_answer"]:
        state["correct_count"] += 1
        log(f"✅ {answer} is Correct! ({duration}s)")
    else:
        state["incorrect_count"] += 1
        log(f"❌ {val} is Wrong. Answer: {state['correct_answer']}")

    if state["incorrect_count"] >= 3:
        end_game()
    else:
        generate_question()

def end_game():
    total = state["correct_count"] + state["incorrect_count"]
    score = round(100 * (state["correct_count"] / total), 1) if total > 0 else 0
    
    document.querySelector("#game-area").innerHTML = f"""
        <div class="stats-card">
            <h3>GAME OVER</h3>
            <p style="font-size: 1.2rem;">{state['player']}, your accuracy was <strong>{score}%</strong></p>
            <p>Correct: {state['correct_count']} | Failed: {state['incorrect_count']}</p>
            <button onclick="window.location.reload()">Try Again</button>
        </div>
    """

def log(message):
    out = document.querySelector("#output")
    out.innerText = message + "\n" + out.innerText

</script>
</body>
</html>
